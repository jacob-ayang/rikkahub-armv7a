# GitHub Actions Workflow é…ç½®æŒ‡å—

## æ¦‚è¿°

æœ¬é¡¹ç›®æä¾›äº†ä¸‰ä¸ªè‡ªåŠ¨ç¼–è¯‘å·¥ä½œæµï¼Œç”¨äºç¼–è¯‘ RikkaHub çš„ä¸åŒç‰ˆæœ¬ã€‚æ‰€æœ‰å·¥ä½œæµéƒ½å¯¹åŸé¡¹ç›®è¿›è¡Œäº†æœ€å°åŒ–ä¾µå…¥ï¼Œä½¿ç”¨åˆ†å±‚æ¬¡çš„æ„å»ºé…ç½®ã€‚

**ç®€åŒ–é…ç½®ï¼š** ä»…éœ€ 2 ä¸ª GitHub Secretsï¼google-services.json ä¼šè‡ªåŠ¨ä»é¡¹ç›®ç›®å½•è¯»å–ã€‚

## å·¥ä½œæµè¯´æ˜

### 1. Build ARM V7 (`.github/workflows/build-armv7.yml`)

ç¼–è¯‘ 32 ä½ ARM V7a ç‰ˆæœ¬ï¼Œé€‚åˆæ—§è®¾å¤‡å’Œé¢„ç®—å‹è®¾å¤‡ã€‚

**è§¦å‘æ¡ä»¶ï¼š**
- æ‰‹åŠ¨è§¦å‘ (workflow_dispatch)
- ä»£ç å˜æ›´æ—¶è‡ªåŠ¨è§¦å‘ï¼ˆåˆ° master åˆ†æ”¯ï¼‰

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- âœ… è‡ªåŠ¨ç‰ˆæœ¬æå–
- âœ… æ„å»ºå‰éªŒè¯ï¼ˆæ£€æŸ¥ google-services.jsonï¼‰
- âœ… è‡ªåŠ¨é‡å‘½å APK
- âœ… GitHub Release å‘å¸ƒ
- âœ… æ„å»ºæ‘˜è¦ç”Ÿæˆ
- âœ… æ•æ„Ÿæ–‡ä»¶æ¸…ç†

**è¾“å‡ºï¼š**
```
rikkahub-{ç‰ˆæœ¬å·}-armv7-{æ—¶é—´æˆ³}.apk
```

### 2. Build Universal (`.github/workflows/build-universal.yml`)

ç¼–è¯‘ 64 ä½é€šç”¨ç‰ˆæœ¬ï¼ˆarm64-v8a + x86_64ï¼‰ï¼Œé€‚åˆç°ä»£è®¾å¤‡ã€‚

**ç‰¹æ€§åŒ Build ARM V7**

**è¾“å‡ºï¼š**
```
rikkahub-{ç‰ˆæœ¬å·}-universal-{æ—¶é—´æˆ³}.apk
```

### 3. Build All Variants (`.github/workflows/build-all.yml`)

åŒæ—¶ç¼–è¯‘æ‰€æœ‰ç‰ˆæœ¬ï¼ˆARM V7 + Universalï¼‰ï¼Œå¹¶åˆ›å»ºç»Ÿä¸€çš„ Releaseã€‚

**ä¼˜ç‚¹ï¼š**
- ğŸ¯ å¹¶è¡Œæ„å»ºï¼ˆfasterï¼‰
- ğŸ“¦ ç»Ÿä¸€ Release é¡µé¢
- ğŸ“Š è¯¦ç»†çš„å‘å¸ƒä¿¡æ¯
- ğŸ å®Œæ•´çš„è®¾å¤‡å…¼å®¹æ€§è¯´æ˜

**è§¦å‘æ¡ä»¶ï¼š**
- ä»…æ‰‹åŠ¨è§¦å‘

---

## é…ç½®æ­¥éª¤ï¼ˆåªéœ€ 2 ä¸ª Secretsï¼ï¼‰

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡å¯†é’¥

#### 1.1 ç”Ÿæˆ Keystore æ–‡ä»¶

å¦‚æœæ²¡æœ‰ keystore æ–‡ä»¶ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆï¼š

```bash
keytool -genkey -v -keystore rikkahub.jks \
  -keyalg RSA -keysize 2048 -validity 10000 \
  -alias rikkahub
```

è¾“å…¥ç›¸å…³ä¿¡æ¯ï¼ˆå¯†ç ã€åˆ«åç­‰ï¼‰ã€‚

#### 1.2 ç¼–ç  Keystore ä¸º Base64

**åœ¨ Linux/Mac ä¸Šï¼š**
```bash
cat rikkahub.jks | base64 -w 0 > keystore_base64.txt
cat keystore_base64.txt  # å¤åˆ¶è¾“å‡ºå†…å®¹
```

**åœ¨ Windows PowerShell ä¸Šï¼š**
```powershell
$base64 = [Convert]::ToBase64String([io.File]::ReadAllBytes("rikkahub.jks"))
$base64 | Set-Clipboard
Write-Host "å·²å¤åˆ¶åˆ°å‰ªè´´æ¿"
```

#### 1.3 æ”¶é›†ç­¾åé…ç½®

åˆ›å»ºæ–‡æœ¬æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š
```
storeFile=app/app.key
storePassword=your_keystore_password
keyAlias=your_key_alias
keyPassword=your_key_password
```

**è¯´æ˜ï¼š**
- `storePassword`: ç”Ÿæˆ keystore æ—¶è®¾ç½®çš„ä¸»å¯†ç 
- `keyAlias`: ç”Ÿæˆ keystore æ—¶è®¾ç½®çš„åˆ«åï¼ˆé»˜è®¤ï¼šrikkahubï¼‰
- `keyPassword`: ç”Ÿæˆ keystore æ—¶è®¾ç½®çš„å¯†é’¥å¯†ç 

### ç¬¬äºŒæ­¥ï¼šæ·»åŠ  GitHub Secrets

1. è¿›å…¥ GitHub ä»“åº“ â†’ **Settings**
2. å·¦ä¾§èœå• â†’ **Secrets and variables** â†’ **Actions**
3. ç‚¹å‡» **New repository secret**ï¼Œæ·»åŠ ä»¥ä¸‹ä¸¤ä¸ª Secretï¼š

| Secret åç§° | å€¼ | è¯´æ˜ |
|------------|-----|------|
| `KEY_BASE64` | keystore Base64 å­—ç¬¦ä¸² | Keystore æ–‡ä»¶çš„å®Œæ•´ Base64 ç¼–ç  |
| `SIGNING_CONFIG` | ç­¾åé…ç½®å†…å®¹ | 4 è¡Œé…ç½®ï¼ˆè§ 1.3ï¼‰ |

**æ·»åŠ æ–¹æ³•ï¼š**
```
Secret name: KEY_BASE64
Value: [ç²˜è´´ Base64 å­—ç¬¦ä¸²]
ç‚¹å‡» "Add secret"
```

é‡å¤ä»¥ä¸Šæ­¥éª¤ï¼Œæ·»åŠ  SIGNING_CONFIGã€‚

**âœ… ä¸éœ€è¦æ·»åŠ  GOOGLE_SERVICES_JSONï¼** å·¥ä½œæµä¼šè‡ªåŠ¨ä» `app/google-services.json` è¯»å–ã€‚

### ç¬¬ä¸‰æ­¥ï¼šéªŒè¯é…ç½®

è¿è¡Œä»»ä½•å·¥ä½œæµå‰ï¼Œå¯ä»¥é€šè¿‡æ‰‹åŠ¨è§¦å‘æ¥æµ‹è¯•é…ç½®ï¼š

1. è¿›å…¥ GitHub ä»“åº“ â†’ **Actions**
2. é€‰æ‹© **Build ARM V7** / **Build Universal** / **Build All Variants**
3. ç‚¹å‡» **Run workflow**
4. åœ¨å¼¹å‡ºèœå•ä¸­é€‰æ‹©ï¼š
   - å‘å¸ƒç±»å‹ï¼š`draft`ï¼ˆè‰ç¨¿ï¼‰
   - ç‚¹å‡» **Run workflow**

---

## ä½¿ç”¨æŒ‡å—

### æ‰‹åŠ¨ç¼–è¯‘

#### ç¼–è¯‘å•ä¸ªç‰ˆæœ¬ï¼ˆARM V7ï¼‰

1. **GitHub ç½‘é¡µæ“ä½œï¼š**
   - è¿›å…¥ **Actions** æ ‡ç­¾
   - é€‰æ‹© **Build ARM V7**
   - ç‚¹å‡» **Run workflow**
   - é€‰æ‹©å‘å¸ƒç±»å‹ï¼š
     - `draft`: è‰ç¨¿ç‰ˆæœ¬ï¼ˆæµ‹è¯•ç”¨ï¼‰
     - `prerelease`: é¢„å‘å¸ƒï¼ˆRC ç‰ˆï¼‰
     - `release`: æ­£å¼å‘å¸ƒ
   - ç‚¹å‡» **Run workflow**

2. **ç­‰å¾…ç¼–è¯‘å®Œæˆï¼š**
   - å¯åœ¨ Actions é¡µé¢çœ‹åˆ°å®æ—¶æ—¥å¿—
   - ç¼–è¯‘é€šå¸¸éœ€è¦ 5-10 åˆ†é’Ÿ

3. **è·å–ç»“æœï¼š**
   - ç¼–è¯‘å®Œæˆåï¼Œè¿›å…¥ **Release** é¡µé¢
   - æ ¹æ®å‘å¸ƒç±»å‹çœ‹åˆ°å¯¹åº”çš„ç‰ˆæœ¬
   - ä¸‹è½½ APK æ–‡ä»¶

#### ç¼–è¯‘æ‰€æœ‰ç‰ˆæœ¬ï¼ˆæ¨èï¼‰

æµç¨‹åŒä¸Šï¼Œä½†é€‰æ‹© **Build All Variants**ï¼Œä¼šåŒæ—¶ç¼–è¯‘ ARM V7 å’Œ Universal ä¸¤ä¸ªç‰ˆæœ¬ï¼Œå¹¶åˆ›å»ºç»Ÿä¸€çš„ Releaseã€‚

### è‡ªåŠ¨ç¼–è¯‘

å½“ä»¥ä¸‹æƒ…å†µå‘ç”Ÿæ—¶ï¼ŒBuild ARM V7 å’Œ Build Universal ä¼šè‡ªåŠ¨è§¦å‘ï¼š

- æ¨é€åˆ° `master` åˆ†æ”¯
- ä¿®æ”¹ä»¥ä¸‹è·¯å¾„ï¼š
  - `app/src/**`
  - `ai/src/**`
  - `common/src/**`
  - `highlight/src/**`
  - `search/src/**`
  - `tts/src/**`
  - `document/src/**`
  - `app/build.gradle.kts`
  - `build.gradle.kts`

**æ³¨æ„ï¼š** è‡ªåŠ¨ç¼–è¯‘ä¸ä¼šåˆ›å»º Releaseï¼Œåªç”Ÿæˆ Artifactsã€‚ä¸‹è½½ Artifacts è¿›è¡Œæµ‹è¯•ã€‚

---

## ç›‘æ§å’Œè°ƒè¯•

### æŸ¥çœ‹ç¼–è¯‘æ—¥å¿—

1. è¿›å…¥ **Actions** æ ‡ç­¾
2. é€‰æ‹©å¯¹åº”çš„ workflow run
3. é€‰æ‹© **build-armv7** / **build-universal** / **build-all** job
4. æŸ¥çœ‹è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—

### å¸¸è§é—®é¢˜æ’æŸ¥

#### âŒ é”™è¯¯ï¼šMissing required secrets

**åŸå› ï¼š** Secret æœªæ­£ç¡®é…ç½®

**è§£å†³ï¼š**
1. ç¡®è®¤å·²æ·»åŠ ä¸¤ä¸ª Secretï¼š`KEY_BASE64`, `SIGNING_CONFIG`
2. ç¡®è®¤ Secret å€¼éç©º
3. æ£€æŸ¥ Secret åç§°æ‹¼å†™æ˜¯å¦å®Œå…¨ä¸€è‡´ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰

#### âŒ é”™è¯¯ï¼šapp/google-services.json not found

**åŸå› ï¼š** google-services.json ä¸åœ¨ app ç›®å½•ä¸‹

**è§£å†³ï¼š**
1. ç¡®ä¿ `app/google-services.json` å­˜åœ¨
2. å¦‚æœæ–‡ä»¶è¢« gitignoreï¼Œéœ€è¦æ·»åŠ åˆ°ç‰ˆæœ¬æ§åˆ¶ä¸­
3. æˆ–è€…åœ¨ä»“åº“ä¸­ä¿ç•™è¯¥æ–‡ä»¶

#### âŒ é”™è¯¯ï¼šAPK not found in build outputs

**åŸå› ï¼š** ç¼–è¯‘å¤±è´¥

**è§£å†³ï¼š**
1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼ŒæŸ¥æ‰¾ gradle é”™è¯¯ä¿¡æ¯
2. ç¡®è®¤ä»£ç åœ¨æœ¬åœ°èƒ½ç¼–è¯‘é€šè¿‡
3. æ£€æŸ¥ç­¾åé…ç½®æ˜¯å¦æ­£ç¡®

#### âŒ é”™è¯¯ï¼šBuild credentials not prepared

**åŸå› ï¼š** Base64 è§£ç å¤±è´¥æˆ–å¯†é’¥æ–‡ä»¶æ ¼å¼é”™è¯¯

**è§£å†³ï¼š**
1. é‡æ–°ç”Ÿæˆ Base64 ç¼–ç 
2. ç¡®è®¤åŸ keystore æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼ˆ.jksï¼‰
3. æ£€æŸ¥ SIGNING_CONFIG æ ¼å¼ï¼ˆ4 è¡Œé…ç½®ï¼‰

#### âš ï¸ è­¦å‘Šï¼šAPK è¿‡å¤§

**åŸå› ï¼š** æ„å»ºè¾“å‡ºåŒ…å«äº†å¤šä¸ªæ¶æ„

**è§£å†³ï¼š**
- è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œé€šå¸¸ç”± `splits` é…ç½®å¯¼è‡´
- æœ€ç»ˆçš„ APK åªåŒ…å«å•ä¸ªæ¶æ„ï¼ˆARM V7a æˆ– Universalï¼‰

---

## æœ€ä½³å®è·µ

### ğŸ¯ ç‰ˆæœ¬ç®¡ç†

| åœºæ™¯ | å‘å¸ƒç±»å‹ | è¯´æ˜ |
|-----|--------|------|
| å¼€å‘æµ‹è¯• | `draft` | ä¸æ˜¾ç¤ºåœ¨ Release åˆ—è¡¨ï¼Œä»…ä¾›å†…éƒ¨æµ‹è¯• |
| å€™é€‰ç‰ˆæœ¬ | `prerelease` | æ˜¾ç¤ºä¸º"é¢„å‘å¸ƒ"ï¼Œç”¨äº RC æµ‹è¯• |
| æ­£å¼å‘å¸ƒ | `release` | æ­£å¼ç‰ˆæœ¬ï¼Œæ˜¾ç¤ºåœ¨ Release ä¸»åˆ—è¡¨ |

### ğŸ“¦ å‘½åè§„èŒƒ

å·¥ä½œæµè‡ªåŠ¨ç”Ÿæˆçš„ APK å‘½åæ ¼å¼ï¼š
```
rikkahub-{version}-{variant}-{timestamp}.apk
```

ç¤ºä¾‹ï¼š
- `rikkahub-1.7.7-armv7-20250104_143022.apk`
- `rikkahub-1.7.7-universal-20250104_143022.apk`

### ğŸ” å®‰å…¨å»ºè®®

1. **Keystore æ–‡ä»¶ï¼š**
   - æ°¸è¿œä¸è¦æäº¤ keystore æ–‡ä»¶åˆ° GitHub
   - ä»…ä½œä¸º Base64 å­—ç¬¦ä¸²å­˜å‚¨åœ¨ Secrets ä¸­
   - å®šæœŸå¤‡ä»½ keystore æ–‡ä»¶ï¼ˆç¦»çº¿å­˜å‚¨ï¼‰

2. **Google Services æ–‡ä»¶ï¼š**
   - å¦‚æœåŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œä½¿ç”¨ .gitignore æ’é™¤
   - åœ¨æœ¬åœ°ç¯å¢ƒä¸­è·å–æ­¤æ–‡ä»¶
   - ä¿æŒæ–‡ä»¶çš„ç§å¯†æ€§å’Œå®‰å…¨æ€§

3. **å¯†ç ç®¡ç†ï¼š**
   - ä½¿ç”¨å¼ºå¯†ç ç”Ÿæˆ keystore
   - ä¸è¦åœ¨ä»£ç æˆ–æäº¤ä¿¡æ¯ä¸­é€éœ²å¯†ç 
   - å®šæœŸæ›´æ¢å¯†ç 

### âš¡ æ€§èƒ½ä¼˜åŒ–

1. **ç¼“å­˜åˆ©ç”¨ï¼š**
   - Gradle ç¼“å­˜è‡ªåŠ¨å¯ç”¨ï¼ˆ`cache: gradle`ï¼‰
   - å‡å°‘ç¼–è¯‘æ—¶é—´ 30-50%

2. **å¹¶è¡Œæ„å»ºï¼š**
   - Build All Variants ä½¿ç”¨çŸ©é˜µç­–ç•¥å¹¶è¡Œç¼–è¯‘
   - ä¸¤ä¸ªç‰ˆæœ¬åŒæ—¶æ„å»ºï¼Œä¸å¢åŠ æ€»è€—æ—¶

3. **å¢é‡æ„å»ºï¼š**
   - è‡ªåŠ¨è§¦å‘æ—¶åªæœ‰ç›¸å…³æ–‡ä»¶å˜æ›´æ—¶æ‰ç¼–è¯‘
   - å‡å°‘ä¸å¿…è¦çš„ç¼–è¯‘

---

## å·¥ä½œæµæ¶æ„è®¾è®¡

### æœ€å°ä¾µå…¥æ€§åŸåˆ™

æœ¬å·¥ä½œæµçš„è®¾è®¡å®Œå…¨éµå¾ª"æœ€å°ä¾µå…¥æ€§"åŸåˆ™ï¼š

âœ… **ä¸ä¿®æ”¹åŸé¡¹ç›®æ–‡ä»¶ï¼š**
- æ‰€æœ‰ workflow éƒ½æ˜¯ç‹¬ç«‹çš„ YAML é…ç½®
- ä¸ä¿®æ”¹ `app/build.gradle.kts` çš„ä¸»é€»è¾‘
- ä¸æ·»åŠ ä»»ä½• hook æˆ–è„šæœ¬åˆ°åŸé¡¹ç›®

âœ… **åˆ©ç”¨ç°æœ‰çš„ flavor é…ç½®ï¼š**
- ä½¿ç”¨å·²æœ‰çš„ `armv7` å’Œ `universal` flavor
- è°ƒç”¨æ ‡å‡†çš„ gradle ä»»åŠ¡ï¼ˆ`assembleArmv7Release` ç­‰ï¼‰
- æ— éœ€ä¿®æ”¹ç¼–è¯‘æµç¨‹

âœ… **éš”ç¦»æ•æ„Ÿä¿¡æ¯ï¼š**
- æ‰€æœ‰å¯†é’¥é€šè¿‡ GitHub Secrets ä¼ é€’
- google-services.json ä»ä»“åº“æœ¬åœ°è¯»å–
- ç¼–è¯‘åè‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶
- ä¸æ±¡æŸ“é¡¹ç›®æ–‡ä»¶

âœ… **æ¡ä»¶æ‰§è¡Œï¼š**
- ä½¿ç”¨ workflow çš„ `if` æ¡ä»¶æ§åˆ¶æ­¥éª¤æ‰§è¡Œ
- æ ¹æ®äº‹ä»¶ç±»å‹é€‰æ‹©æ€§å‘å¸ƒ Release
- çµæ´»çš„è§¦å‘æ¡ä»¶é…ç½®

---

## å¸¸è§é—®é¢˜ (FAQ)

### Q: ä¸ºä»€ä¹ˆåªéœ€è¦ 2 ä¸ª Secretsï¼Ÿ

**A:** å› ä¸º google-services.json å·²ç»æäº¤åˆ°ä»“åº“ä¸­ï¼ŒWorkflow å¯ä»¥ç›´æ¥è¯»å–ã€‚è¿™ç®€åŒ–äº†é…ç½®æµç¨‹ã€‚

### Q: å¦‚æœ google-services.json åŒ…å«æ•æ„Ÿä¿¡æ¯æ€ä¹ˆåŠï¼Ÿ

**A:** 
- å°† google-services.json æ·»åŠ åˆ° .gitignore
- åœ¨æœ¬åœ°ä¿ç•™è¯¥æ–‡ä»¶ï¼ˆä¸æäº¤ï¼‰
- Workflow ä¼šåœ¨æœ¬åœ°æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨

### Q: ç¼–è¯‘éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ

**A:** å–å†³äºç½‘ç»œå’Œç¼“å­˜ï¼š
- é¦–æ¬¡ç¼–è¯‘ï¼š8-12 åˆ†é’Ÿ
- æœ‰ç¼“å­˜ï¼š4-6 åˆ†é’Ÿ
- å¹¶è¡Œç¼–è¯‘ä¸¤ä¸ªç‰ˆæœ¬ï¼šä»æ˜¯ 6-8 åˆ†é’Ÿ

### Q: èƒ½å¦åœ¨æœ¬åœ°ç¼–è¯‘ï¼Ÿ

**A:** å¯ä»¥ï¼ä½¿ç”¨ Makefileï¼š
```bash
make check-config          # æ£€æŸ¥é…ç½®
make build-armv7          # ç¼–è¯‘ ARM V7
make build-universal      # ç¼–è¯‘ Universal
make build-all            # ç¼–è¯‘æ‰€æœ‰ç‰ˆæœ¬
```

è¯¦è§ `QUICK_START_ARMV7.md`

### Q: ç¼–è¯‘å¤±è´¥å¦‚ä½•è°ƒè¯•ï¼Ÿ

**A:** 
1. æŸ¥çœ‹ Actions æ—¥å¿—ä¸­çš„ Gradle é”™è¯¯ä¿¡æ¯
2. åœ¨æœ¬åœ°é‡ç°é”™è¯¯ï¼š
   ```bash
   ./gradlew assembleArmv7Release --stacktrace
   ```
3. ä¿®å¤åæ¨é€ä»£ç 
4. é‡æ–°è§¦å‘ workflow

### Q: APK ç­¾åä¿¡æ¯åœ¨å“ªé‡Œï¼Ÿ

**A:** Workflow ä¸­çš„ `SIGNING_CONFIG` Secret åŒ…å«ç­¾åä¿¡æ¯ï¼ŒGradle è‡ªåŠ¨è¯»å–å¹¶åº”ç”¨ã€‚

### Q: å‘å¸ƒçš„ Release å¯ä»¥åˆ é™¤å—ï¼Ÿ

**A:** å¯ä»¥ï¼Œåœ¨ GitHub Release é¡µé¢æ‰‹åŠ¨åˆ é™¤ã€‚è‡ªåŠ¨ç”Ÿæˆçš„ Artifacts ä¹Ÿå¯ä»¥åˆ é™¤ï¼ˆGitHub Actions è‡ªåŠ¨æ¸…ç†è¿‡æœŸ artifactsï¼‰ã€‚

---

## ç»´æŠ¤å’Œæ›´æ–°

### æ›´æ–°å·¥ä½œæµ

å¦‚éœ€ä¿®æ”¹å·¥ä½œæµï¼Œç¼–è¾‘å¯¹åº”çš„ `.github/workflows/*.yml` æ–‡ä»¶ï¼š

```bash
git pull origin master
# ç¼–è¾‘å·¥ä½œæµæ–‡ä»¶
git add .github/workflows/build-*.yml
git commit -m "chore: update workflows"
git push origin master
```

### æ›´æ–°ä¾èµ–

å¦‚éœ€æ›´æ–° GitHub Actions ä¾èµ–ç‰ˆæœ¬ï¼š

```yaml
- uses: actions/checkout@v4     # â† å¯æ›´æ–°ç‰ˆæœ¬
- uses: actions/setup-java@v4   # â† å¯æ›´æ–°ç‰ˆæœ¬
- uses: android-actions/setup-android@v3  # â† å¯æ›´æ–°ç‰ˆæœ¬
```

æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬ï¼š
- [actions/checkout](https://github.com/actions/checkout/releases)
- [actions/setup-java](https://github.com/actions/setup-java/releases)
- [android-actions/setup-android](https://github.com/android-actions/setup-android/releases)

---

## æ”¯æŒå’Œè´¡çŒ®

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æœ¬æ–‡æ¡£å’Œ `QUICK_START_ARMV7.md`
2. æ£€æŸ¥ GitHub Issues
3. æäº¤æ–° Issue æˆ– Discussion

---

**æœ€åæ›´æ–°ï¼š** 2025-01-04

---

## ä½¿ç”¨æŒ‡å—

### æ‰‹åŠ¨ç¼–è¯‘

#### ç¼–è¯‘å•ä¸ªç‰ˆæœ¬ï¼ˆARM V7ï¼‰

1. **GitHub ç½‘é¡µæ“ä½œï¼š**
   - è¿›å…¥ **Actions** æ ‡ç­¾
   - é€‰æ‹© **Build ARM V7**
   - ç‚¹å‡» **Run workflow**
   - é€‰æ‹©å‘å¸ƒç±»å‹ï¼š
     - `draft`: è‰ç¨¿ç‰ˆæœ¬ï¼ˆæµ‹è¯•ç”¨ï¼‰
     - `prerelease`: é¢„å‘å¸ƒï¼ˆRC ç‰ˆï¼‰
     - `release`: æ­£å¼å‘å¸ƒ
   - ç‚¹å‡» **Run workflow**

2. **ç­‰å¾…ç¼–è¯‘å®Œæˆï¼š**
   - å¯åœ¨ Actions é¡µé¢çœ‹åˆ°å®æ—¶æ—¥å¿—
   - ç¼–è¯‘é€šå¸¸éœ€è¦ 5-10 åˆ†é’Ÿ

3. **è·å–ç»“æœï¼š**
   - ç¼–è¯‘å®Œæˆåï¼Œè¿›å…¥ **Release** é¡µé¢
   - æ ¹æ®å‘å¸ƒç±»å‹çœ‹åˆ°å¯¹åº”çš„ç‰ˆæœ¬
   - ä¸‹è½½ APK æ–‡ä»¶

#### ç¼–è¯‘æ‰€æœ‰ç‰ˆæœ¬ï¼ˆæ¨èï¼‰

æµç¨‹åŒä¸Šï¼Œä½†é€‰æ‹© **Build All Variants**ï¼Œä¼šåŒæ—¶ç¼–è¯‘ ARM V7 å’Œ Universal ä¸¤ä¸ªç‰ˆæœ¬ï¼Œå¹¶åˆ›å»ºç»Ÿä¸€çš„ Releaseã€‚

### è‡ªåŠ¨ç¼–è¯‘

å½“ä»¥ä¸‹æƒ…å†µå‘ç”Ÿæ—¶ï¼ŒBuild ARM V7 å’Œ Build Universal ä¼šè‡ªåŠ¨è§¦å‘ï¼š

- æ¨é€åˆ° `master` åˆ†æ”¯
- ä¿®æ”¹ä»¥ä¸‹è·¯å¾„ï¼š
  - `app/src/**`
  - `ai/src/**`
  - `common/src/**`
  - `highlight/src/**`
  - `search/src/**`
  - `tts/src/**`
  - `document/src/**`
  - `app/build.gradle.kts`
  - `build.gradle.kts`

**æ³¨æ„ï¼š** è‡ªåŠ¨ç¼–è¯‘ä¸ä¼šåˆ›å»º Releaseï¼Œåªç”Ÿæˆ Artifactsã€‚ä¸‹è½½ Artifacts è¿›è¡Œæµ‹è¯•ã€‚

---

## ç›‘æ§å’Œè°ƒè¯•

### æŸ¥çœ‹ç¼–è¯‘æ—¥å¿—

1. è¿›å…¥ **Actions** æ ‡ç­¾
2. é€‰æ‹©å¯¹åº”çš„ workflow run
3. é€‰æ‹© **build-armv7** / **build-universal** / **build-all** job
4. æŸ¥çœ‹è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—

### å¸¸è§é—®é¢˜æ’æŸ¥

#### âŒ é”™è¯¯ï¼šMissing required secrets

**åŸå› ï¼š** Secret æœªæ­£ç¡®é…ç½®

**è§£å†³ï¼š**
1. ç¡®è®¤å·²æ·»åŠ ä¸‰ä¸ª Secretï¼š`KEY_BASE64`, `SIGNING_CONFIG`, `GOOGLE_SERVICES_JSON`
2. ç¡®è®¤ Secret å€¼éç©º
3. æ£€æŸ¥ Secret åç§°æ‹¼å†™æ˜¯å¦å®Œå…¨ä¸€è‡´

#### âŒ é”™è¯¯ï¼šAPK not found in build outputs

**åŸå› ï¼š** ç¼–è¯‘å¤±è´¥

**è§£å†³ï¼š**
1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼ŒæŸ¥æ‰¾ gradle é”™è¯¯ä¿¡æ¯
2. ç¡®è®¤ä»£ç åœ¨æœ¬åœ°èƒ½ç¼–è¯‘é€šè¿‡
3. æ£€æŸ¥ç­¾åé…ç½®æ˜¯å¦æ­£ç¡®

#### âŒ é”™è¯¯ï¼šBuild credentials not prepared

**åŸå› ï¼š** Base64 è§£ç å¤±è´¥æˆ–å¯†é’¥æ–‡ä»¶æ ¼å¼é”™è¯¯

**è§£å†³ï¼š**
1. é‡æ–°ç”Ÿæˆ Base64 ç¼–ç 
2. ç¡®è®¤åŸ keystore æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼ˆ.jksï¼‰
3. æ£€æŸ¥ SIGNING_CONFIG æ ¼å¼ï¼ˆ4 è¡Œé…ç½®ï¼‰

#### âš ï¸ è­¦å‘Šï¼šAPK è¿‡å¤§

**åŸå› ï¼š** æ„å»ºè¾“å‡ºåŒ…å«äº†å¤šä¸ªæ¶æ„

**è§£å†³ï¼š**
- è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œé€šå¸¸ç”± `splits` é…ç½®å¯¼è‡´
- æœ€ç»ˆçš„ APK åªåŒ…å«å•ä¸ªæ¶æ„ï¼ˆARM V7a æˆ– Universalï¼‰

---

## æœ€ä½³å®è·µ

### ğŸ¯ ç‰ˆæœ¬ç®¡ç†

| åœºæ™¯ | å‘å¸ƒç±»å‹ | è¯´æ˜ |
|-----|--------|------|
| å¼€å‘æµ‹è¯• | `draft` | ä¸æ˜¾ç¤ºåœ¨ Release åˆ—è¡¨ï¼Œä»…ä¾›å†…éƒ¨æµ‹è¯• |
| å€™é€‰ç‰ˆæœ¬ | `prerelease` | æ˜¾ç¤ºä¸º"é¢„å‘å¸ƒ"ï¼Œç”¨äº RC æµ‹è¯• |
| æ­£å¼å‘å¸ƒ | `release` | æ­£å¼ç‰ˆæœ¬ï¼Œæ˜¾ç¤ºåœ¨ Release ä¸»åˆ—è¡¨ |

### ğŸ“¦ å‘½åè§„èŒƒ

å·¥ä½œæµè‡ªåŠ¨ç”Ÿæˆçš„ APK å‘½åæ ¼å¼ï¼š
```
rikkahub-{version}-{variant}-{timestamp}.apk
```

ç¤ºä¾‹ï¼š
- `rikkahub-1.7.7-armv7-20250104_143022.apk`
- `rikkahub-1.7.7-universal-20250104_143022.apk`

### ğŸ” å®‰å…¨å»ºè®®

1. **Keystore æ–‡ä»¶ï¼š**
   - æ°¸è¿œä¸è¦æäº¤ keystore æ–‡ä»¶åˆ° GitHub
   - ä»…ä½œä¸º Base64 å­—ç¬¦ä¸²å­˜å‚¨åœ¨ Secrets ä¸­
   - å®šæœŸå¤‡ä»½ keystore æ–‡ä»¶ï¼ˆç¦»çº¿å­˜å‚¨ï¼‰

2. **å¯†ç ç®¡ç†ï¼š**
   - ä½¿ç”¨å¼ºå¯†ç ç”Ÿæˆ keystore
   - ä¸è¦åœ¨ä»£ç æˆ–æäº¤ä¿¡æ¯ä¸­é€éœ²å¯†ç 
   - å®šæœŸæ›´æ¢å¯†ç 

3. **Google Servicesï¼š**
   - ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç  Firebase é…ç½®
   - ä» Firebase Console å®šæœŸæ›´æ–°é…ç½®
   - ä»…åœ¨ CI ç¯å¢ƒä¸­å­˜å‚¨æ•æ„Ÿä¿¡æ¯

### âš¡ æ€§èƒ½ä¼˜åŒ–

1. **ç¼“å­˜åˆ©ç”¨ï¼š**
   - Gradle ç¼“å­˜è‡ªåŠ¨å¯ç”¨ï¼ˆ`cache: gradle`ï¼‰
   - å‡å°‘ç¼–è¯‘æ—¶é—´ 30-50%

2. **å¹¶è¡Œæ„å»ºï¼š**
   - Build All Variants ä½¿ç”¨çŸ©é˜µç­–ç•¥å¹¶è¡Œç¼–è¯‘
   - ä¸¤ä¸ªç‰ˆæœ¬åŒæ—¶æ„å»ºï¼Œä¸å¢åŠ æ€»è€—æ—¶

3. **å¢é‡æ„å»ºï¼š**
   - è‡ªåŠ¨è§¦å‘æ—¶åªæœ‰ç›¸å…³æ–‡ä»¶å˜æ›´æ—¶æ‰ç¼–è¯‘
   - å‡å°‘ä¸å¿…è¦çš„ç¼–è¯‘

---

## å·¥ä½œæµæ¶æ„è®¾è®¡

### æœ€å°ä¾µå…¥æ€§åŸåˆ™

æœ¬å·¥ä½œæµçš„è®¾è®¡å®Œå…¨éµå¾ª"æœ€å°ä¾µå…¥æ€§"åŸåˆ™ï¼š

âœ… **ä¸ä¿®æ”¹åŸé¡¹ç›®æ–‡ä»¶ï¼š**
- æ‰€æœ‰ workflow éƒ½æ˜¯ç‹¬ç«‹çš„ YAML é…ç½®
- ä¸ä¿®æ”¹ `app/build.gradle.kts` çš„ä¸»é€»è¾‘
- ä¸æ·»åŠ ä»»ä½• hook æˆ–è„šæœ¬åˆ°åŸé¡¹ç›®

âœ… **åˆ©ç”¨ç°æœ‰çš„ flavor é…ç½®ï¼š**
- ä½¿ç”¨å·²æœ‰çš„ `armv7` å’Œ `universal` flavor
- è°ƒç”¨æ ‡å‡†çš„ gradle ä»»åŠ¡ï¼ˆ`assembleArmv7Release` ç­‰ï¼‰
- æ— éœ€ä¿®æ”¹ç¼–è¯‘æµç¨‹

âœ… **éš”ç¦»æ•æ„Ÿä¿¡æ¯ï¼š**
- æ‰€æœ‰å¯†é’¥é€šè¿‡ GitHub Secrets ä¼ é€’
- ç¼–è¯‘åè‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶
- ä¸æ±¡æŸ“é¡¹ç›®æ–‡ä»¶

âœ… **æ¡ä»¶æ‰§è¡Œï¼š**
- ä½¿ç”¨ workflow çš„ `if` æ¡ä»¶æ§åˆ¶æ­¥éª¤æ‰§è¡Œ
- æ ¹æ®äº‹ä»¶ç±»å‹é€‰æ‹©æ€§å‘å¸ƒ Release
- çµæ´»çš„è§¦å‘æ¡ä»¶é…ç½®

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     GitHub Repository               â”‚
â”‚  - Build ARM V7 workflow            â”‚
â”‚  - Build Universal workflow         â”‚
â”‚  - Build All workflow               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GitHub Secrets (Encrypted)        â”‚
â”‚  - KEY_BASE64                       â”‚
â”‚  - SIGNING_CONFIG                   â”‚
â”‚  - GOOGLE_SERVICES_JSON             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Ubuntu Runner (CI Environment)    â”‚
â”‚  - Setup JDK 17                     â”‚
â”‚  - Setup Android SDK                â”‚
â”‚  - Prepare credentials              â”‚
â”‚  - Build with Gradle                â”‚
â”‚  - Sign APK                         â”‚
â”‚  - Generate Release                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      GitHub Artifacts & Release     â”‚
â”‚  - Artifacts (30 å¤©ä¿ç•™)            â”‚
â”‚  - Release (æ°¸ä¹…ä¿ç•™)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å¸¸è§é—®é¢˜ (FAQ)

### Q: ä¸ºä»€ä¹ˆæœ‰ä¸‰ä¸ª workflowï¼Ÿ

**A:** æ»¡è¶³ä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼š
- **Build ARM V7**: ç¼–è¯‘ 32 ä½ç‰ˆæœ¬ï¼ˆæ—§è®¾å¤‡ï¼‰
- **Build Universal**: ç¼–è¯‘ 64 ä½ç‰ˆæœ¬ï¼ˆç°ä»£è®¾å¤‡ï¼‰
- **Build All**: åŒæ—¶ç¼–è¯‘ä¸¤ä¸ªç‰ˆæœ¬ï¼ˆå®Œæ•´å‘å¸ƒï¼‰

### Q: ç¼–è¯‘éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ

**A:** å–å†³äºç½‘ç»œå’Œç¼“å­˜ï¼š
- é¦–æ¬¡ç¼–è¯‘ï¼š8-12 åˆ†é’Ÿ
- æœ‰ç¼“å­˜ï¼š4-6 åˆ†é’Ÿ
- å¹¶è¡Œç¼–è¯‘ä¸¤ä¸ªç‰ˆæœ¬ï¼šä»æ˜¯ 6-8 åˆ†é’Ÿ

### Q: èƒ½å¦åœ¨æœ¬åœ°ç¼–è¯‘ï¼Ÿ

**A:** å¯ä»¥ï¼ä½¿ç”¨ Makefileï¼š
```bash
make check-config          # æ£€æŸ¥é…ç½®
make build-armv7          # ç¼–è¯‘ ARM V7
make build-universal      # ç¼–è¯‘ Universal
make build-all            # ç¼–è¯‘æ‰€æœ‰ç‰ˆæœ¬
```

è¯¦è§ `QUICK_START_ARMV7.md`

### Q: ç¼–è¯‘å¤±è´¥å¦‚ä½•è°ƒè¯•ï¼Ÿ

**A:** 
1. æŸ¥çœ‹ Actions æ—¥å¿—ä¸­çš„ Gradle é”™è¯¯ä¿¡æ¯
2. åœ¨æœ¬åœ°é‡ç°é”™è¯¯ï¼š
   ```bash
   ./gradlew assembleArmv7Release --stacktrace
   ```
3. ä¿®å¤åæ¨é€ä»£ç 
4. é‡æ–°è§¦å‘ workflow

### Q: APK ç­¾åä¿¡æ¯åœ¨å“ªé‡Œï¼Ÿ

**A:** å·¥ä½œæµä¸­çš„ `SIGNING_CONFIG` Secret åŒ…å«ç­¾åä¿¡æ¯ï¼ŒGradle è‡ªåŠ¨è¯»å–å¹¶åº”ç”¨ã€‚

### Q: å‘å¸ƒçš„ Release å¯ä»¥åˆ é™¤å—ï¼Ÿ

**A:** å¯ä»¥ï¼Œåœ¨ GitHub Release é¡µé¢æ‰‹åŠ¨åˆ é™¤ã€‚è‡ªåŠ¨ç”Ÿæˆçš„ Artifacts ä¹Ÿå¯ä»¥åˆ é™¤ï¼ˆGitHub Actions è‡ªåŠ¨æ¸…ç†è¿‡æœŸ artifactsï¼‰ã€‚

---

## ç»´æŠ¤å’Œæ›´æ–°

### æ›´æ–°å·¥ä½œæµ

å¦‚éœ€ä¿®æ”¹å·¥ä½œæµï¼Œç¼–è¾‘å¯¹åº”çš„ `.github/workflows/*.yml` æ–‡ä»¶ï¼š

```bash
git pull origin master
# ç¼–è¾‘å·¥ä½œæµæ–‡ä»¶
git add .github/workflows/build-*.yml
git commit -m "chore: update workflows"
git push origin master
```

### æ›´æ–°ä¾èµ–

å¦‚éœ€æ›´æ–° GitHub Actions ä¾èµ–ç‰ˆæœ¬ï¼š

```yaml
- uses: actions/checkout@v4     # â† å¯æ›´æ–°ç‰ˆæœ¬
- uses: actions/setup-java@v4   # â† å¯æ›´æ–°ç‰ˆæœ¬
- uses: android-actions/setup-android@v3  # â† å¯æ›´æ–°ç‰ˆæœ¬
```

æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬ï¼š
- [actions/checkout](https://github.com/actions/checkout/releases)
- [actions/setup-java](https://github.com/actions/setup-java/releases)
- [android-actions/setup-android](https://github.com/android-actions/setup-android/releases)

---

## æ”¯æŒå’Œè´¡çŒ®

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æœ¬æ–‡æ¡£å’Œ `QUICK_START_ARMV7.md`
2. æ£€æŸ¥ GitHub Issues
3. æäº¤æ–° Issue æˆ– Discussion

---

**æœ€åæ›´æ–°ï¼š** 2025-01-04
